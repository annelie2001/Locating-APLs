<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.13.15' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"theme": "light", "cell_output": "above", "dataframes": "rich", "default_width": "medium", "code_editor_font_size": 14, "default_table_page_size": 10}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "reactive_tests": true, "on_cell_change": "autorun", "watcher_on_save": "lazy", "output_max_bytes": 8000000, "std_stream_max_bytes": 1000000, "default_sql_output": "auto"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "pip"}, "server": {"browser": "default", "follow_symlink": false}, "language_servers": {"pylsp": {"enabled": true, "enable_mypy": true, "enable_ruff": true, "enable_flake8": false, "enable_pydocstyle": false, "enable_pylint": false, "enable_pyflakes": false}}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "medium", "sql_output": "auto"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>project-overview</title>
    <script type="module" crossorigin src="./assets/index-aRpq2G87.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-BqXWXM9d.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.13.15%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20requests%0A%20%20%20%20import%20json%0A%20%20%20%20import%20folium%0A%20%20%20%20from%20folium.plugins%20import%20Fullscreen%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20geopandas%20as%20gpd%0A%20%20%20%20import%20altair%20as%20alt%0A%20%20%20%20from%20shapely.geometry%20import%20Polygon%0A%20%20%20%20import%20branca.colormap%20as%20cm%0A%20%20%20%20%23%20import%20pysd%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20from%20dotenv%20import%20load_dotenv%0A%20%20%20%20import%20os%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20Fullscreen%2C%0A%20%20%20%20%20%20%20%20alt%2C%0A%20%20%20%20%20%20%20%20cm%2C%0A%20%20%20%20%20%20%20%20folium%2C%0A%20%20%20%20%20%20%20%20gpd%2C%0A%20%20%20%20%20%20%20%20json%2C%0A%20%20%20%20%20%20%20%20load_dotenv%2C%0A%20%20%20%20%20%20%20%20mo%2C%0A%20%20%20%20%20%20%20%20os%2C%0A%20%20%20%20%20%20%20%20pd%2C%0A%20%20%20%20%20%20%20%20requests%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(gpd%2C%20pd)%3A%0A%20%20%20%20%23%20Population%20and%20geo%20data%0A%20%20%20%20wuerzburg_gdf%20%3D%20gpd.read_file(%22.%2FData%2Fwuerzburg_bevoelkerung_100m.geojson%22)%0A%20%20%20%20potential_locations_gdf%20%3D%20gpd.read_file(%22.%2FData%2Fapl_candidates_clusters.geojson%22)%0A%0A%0A%20%20%20%20%23%20Simulation%20data%0A%20%20%20%20%23%20sd_model%20%3D%20pysd.read_vensim(%22.%2FVensim-Model%2FAPL-SFD-W%C3%BCrzburg-V3.mdl%22)%0A%20%20%20%20%23%20model_overview%20%3D%20sd_model.doc%0A%20%20%20%20%23%20simulation_results%20%3D%20sd_model.run().reset_index()%0A%0A%20%20%20%20constant_variables%20%3D%20%5B%22Population%22%2C%20%22Population%20growth%20rate%22%2C%20'%22E-shopper%20share%22'%2C%20''%22E-shoppers%20growth%20rate%22''%2C%20%22Online%20purchase%20growth%20rate%22%2C%20%22APL%20market%20growth%20rate%22%2C%20'%22Avg.%20parcels%20per%20APL%20per%20month%22'%5D%0A%20%20%20%20dynamic_variables%20%3D%20%5B%22Market%20Size%22%2C%20'%22Potential%20e-customers%22'%2C%20%22APL%20users%22%2C%20%22Online%20purchases%20per%20year%22%2C%20%22Number%20of%20deliveries%22%2C%20%22Number%20of%20APLs%22%5D%0A%0A%20%20%20%20%23%20filtered_simulation_results%20%3D%20simulation_results%5Bdynamic_variables%5D.copy()%0A%0A%20%20%20%20%23%20for%20col%20in%20dynamic_variables%3A%0A%20%20%20%20%23%20%20%20%20%20filtered_simulation_results%5Bcol%5D%20%3D%20filtered_simulation_results%5Bcol%5D.apply(np.floor)%0A%0A%0A%20%20%20%20%23%20Demand%20Scenarios%0A%20%20%20%20scenario_df%20%3D%20pd.read_csv(%22.%2FData%2Fgenerated_scenarios.csv%22%2C%20sep%3D%22%3B%22)%0A%20%20%20%20scenario_df%5B%22Year%22%5D%20%3D%20scenario_df.index%0A%20%20%20%20scenario_df%20%3D%20scenario_df.melt(id_vars%3D%22Year%22%2C%20var_name%3D%22Scenario%22%2C%20value_name%3D%22Demand%22)%0A%20%20%20%20scenario_df%5B'Scenario_Number'%5D%20%3D%20scenario_df%5B'Scenario'%5D.str.replace('Scenario'%2C%20'').astype(int)%0A%0A%20%20%20%20%23%20Optimization%20results%0A%20%20%20%20results_df%20%3D%20pd.read_csv(%22.%2FData%2Fcombined_results_with_setup_costs.csv%22%2C%20sep%3D%22%3B%22)%0A%20%20%20%20apl_ids%20%3D%20results_df%5B'APL_ID'%5D.drop_duplicates()%0A%20%20%20%20cust_ids%20%3D%20results_df%5B'Customer_ID'%5D.drop_duplicates()%0A%20%20%20%20apl_gdf%20%3D%20wuerzburg_gdf%5Bwuerzburg_gdf%5B'Gitter_ID_100m'%5D.isin(apl_ids)%5D.copy()%0A%20%20%20%20cust_gdf%20%3D%20wuerzburg_gdf%5Bwuerzburg_gdf%5B'Gitter_ID_100m'%5D.isin(cust_ids)%5D.copy()%0A%20%20%20%20apl_gdf%20%3D%20apl_gdf.rename(columns%3D%7B'Gitter_ID_100m'%3A%20'APL_ID'%2C%20'geometry'%3A%20'APL_geometry'%7D)%0A%20%20%20%20cust_gdf%20%3D%20cust_gdf.rename(columns%3D%7B'Gitter_ID_100m'%3A%20'Customer_ID'%2C%20'geometry'%3A%20'Customer_geometry'%7D)%0A%20%20%20%20results_df%20%3D%20results_df.merge(apl_gdf%5B%5B'APL_ID'%2C%20'APL_geometry'%5D%5D%2C%20on%3D'APL_ID'%2C%20how%3D'left')%0A%20%20%20%20results_df%20%3D%20results_df.merge(cust_gdf%5B%5B'Customer_ID'%2C%20'Customer_geometry'%5D%5D%2C%20on%3D'Customer_ID'%2C%20how%3D'left')%0A%20%20%20%20summary_df%20%3D%20pd.read_csv(%22.%2FData%2Fcflp_apl_deployment_summary.csv%22%2C%20sep%3D%22%3B%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20potential_locations_gdf%2C%0A%20%20%20%20%20%20%20%20results_df%2C%0A%20%20%20%20%20%20%20%20scenario_df%2C%0A%20%20%20%20%20%20%20%20summary_df%2C%0A%20%20%20%20%20%20%20%20wuerzburg_gdf%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(json%2C%20load_dotenv%2C%20os%2C%20requests)%3A%0A%20%20%20%20%23%20DHL%20data%20W%C3%BCrzburg%0A%20%20%20%20latitude%20%3D%2049.7913%0A%20%20%20%20longitude%20%3D%209.9534%0A%0A%20%20%20%20load_dotenv()%0A%20%20%20%20dhl_api_key%20%3D%20os.getenv(%22SECRET_KEY_DHL%22)%0A%0A%20%20%20%20url%20%3D%20'https%3A%2F%2Fapi.dhl.com%2Flocation-finder%2Fv1%2Ffind-by-geo'%0A%20%20%20%20headers%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'DHL-API-Key'%3A%20dhl_api_key%2C%0A%20%20%20%20%20%20%20%20'Accept'%3A%20'application%2Fjson'%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23%20request%20parameters%0A%20%20%20%20params_dhl%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'latitude'%3A%20latitude%2C%0A%20%20%20%20%20%20%20%20'longitude'%3A%20longitude%2C%0A%20%20%20%20%20%20%20%20'radius'%3A%205000%2C%20%20%0A%20%20%20%20%20%20%20%20'limit'%3A%2050%2C%0A%20%20%20%20%20%20%20%20'locationType'%3A%20'locker'%0A%20%20%20%20%7D%0A%0A%20%20%20%20response_dhl%20%3D%20requests.get(url%2C%20headers%3Dheaders%2C%20params%3Dparams_dhl)%0A%0A%20%20%20%20packstations%20%3D%20%5B%5D%0A%20%20%20%20if%20response_dhl.status_code%20%3D%3D%20200%3A%0A%20%20%20%20%20%20%20%20data_dhl%20%3D%20response_dhl.json()%0A%20%20%20%20%20%20%20%20for%20location%20in%20data_dhl.get('locations'%2C%20%5B%5D)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20geo%20%3D%20location.get('place'%2C%20%7B%7D).get('geo'%2C%20%7B%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20address%20%3D%20location.get('place'%2C%20%7B%7D).get('address'%2C%20%7B%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20lat%20%3D%20geo.get('latitude')%0A%20%20%20%20%20%20%20%20%20%20%20%20lon%20%3D%20geo.get('longitude')%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20lat%20and%20lon%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20packstations.append(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'name'%3A%20location.get('name'%2C%20'Packstation')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'lat'%3A%20lat%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'lon'%3A%20lon%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'address'%3A%20f%22%7Baddress.get('streetAddress'%2C%20'')%7D%2C%20%7Baddress.get('postalCode'%2C%20'')%7D%20%7Baddress.get('addressLocality'%2C%20'')%7D%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20with%20open('.%2FData%2Fdhl-parcel-lockers_wuerzburg.json'%2C%20'w'%2C%20encoding%3D'utf-8')%20as%20f%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20json.dump(packstations%2C%20f%2C%20ensure_ascii%3DFalse%2C%20indent%3D2)%0A%0A%20%20%20%20%20%20%20%20print(%22Packstationen%20gespeichert.%22)%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(f%22Fehler%20beim%20Abrufen%20der%20Packstationen%3A%20%7Bresponse_dhl.status_code%7D%20-%20%7Bresponse_dhl.text%7D%22)%0A%20%20%20%20return%20(packstations%2C)%0A%0A%0A%40app.cell%0Adef%20_(gpd%2C%20mo)%3A%0A%20%20%20%20def%20heuristic_APLs(gdf%2C%20anzahl%3D1%2C%20mindestabstand_zellen%3D3)%3A%0A%20%20%20%20%20%20%20%20gdf_sorted%20%3D%20gdf.sort_values(by%3D%22Einwohner%22%2C%20ascending%3DFalse).copy()%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20grid-coordinates%0A%20%20%20%20%20%20%20%20gdf_sorted%5B'row'%5D%20%3D%20((gdf_sorted%5B'y_mp_100m'%5D%20-%20gdf_sorted%5B'y_mp_100m'%5D.min())%20%2F%20100).astype(int)%0A%20%20%20%20%20%20%20%20gdf_sorted%5B'col'%5D%20%3D%20((gdf_sorted%5B'x_mp_100m'%5D%20-%20gdf_sorted%5B'x_mp_100m'%5D.min())%20%2F%20100).astype(int)%0A%0A%20%20%20%20%20%20%20%20belegte_zellen%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20ausgewaehlte%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20for%20_%2C%20row%20in%20gdf_sorted.iterrows()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20r%2C%20c%20%3D%20row%5B'row'%5D%2C%20row%5B'col'%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Check%20distance%20to%20existing%20APLs%0A%20%20%20%20%20%20%20%20%20%20%20%20too_close%20%3D%20any(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20abs(r%20-%20br)%20%3C%3D%20mindestabstand_zellen%20and%20abs(c%20-%20bc)%20%3C%3D%20mindestabstand_zellen%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20br%2C%20bc%20in%20belegte_zellen%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20not%20too_close%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20belegte_zellen.append((r%2C%20c))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ausgewaehlte.append(row)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20len(ausgewaehlte)%20%3E%3D%20anzahl%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%0A%0A%20%20%20%20%20%20%20%20return%20gpd.GeoDataFrame(ausgewaehlte%2C%20crs%3Dgdf.crs)%0A%0A%20%20%20%20anzahl_slider%20%3D%20mo.ui.slider(start%3D0%2C%20stop%3D50%2C%20value%3D0%2C%20step%3D1%2C%20label%3D%22Number%20of%20APLs%22)%0A%20%20%20%20return%20anzahl_slider%2C%20heuristic_APLs%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23W%C3%BCrzburg%20Status%20Quo%3A%20Population%20and%20APL%20Landscape%0A%0A%20%20%20%20%23%23Population%20Map%20W%C3%BCrzburg%0A%0A%20%20%20%20Before%20starting%20the%20project%2C%20I%20created%20this%20interactive%20map%20to%20get%20an%20intuition%20for%20the%20problem.%20The%20map%20shows%20the%20population%20density%20of%20the%20city%20of%20W%C3%BCrzburg%20at%20the%20level%20of%20100m%20x%20100m%20grid%20cells%20according%20to%20the%20Zensus%202022%20data.%20Additionally%2C%20you%20can%20activate%20to%20layers%3A%0A%0A%20%20%20%20*%20**DHL%20'Packstationen'%3A**%20The%20locations%20of%20existing%20DHL%20parcel%20lockers%20serve%20as%20a%20qualitative%20real-world%20benchmark%20(There%20are%20currently%20%7B(len(packstations))%7D%20DHL%20parcel%20lockers%20in%20W%C3%BCrzburg)%0A%20%20%20%20*%20**Heuristic%20APL%20locations%3A**%20As%20a%20second%2C%20quantitative%20benchmark%2C%20I%20applied%20a%20heurisitc%20method%20based%20on%20population%20density%20to%20identify%20potentially%20optimal%20APL%20locations.%20This%20method%20places%20APLs%20in%20the%20most%20densely%20populated%20areas%20while%20maintaining%20a%20minimum%20distance%20between%20locations.%20You%20can%20setup%20APLs%20according%20to%20this%20heuristic%20with%20the%20interactive%20slider.%0A%0A%20%20%20%20When%20setting%20up%20approximately%2040%20APLs%20with%20the%20heuristic%20approach%2C%20the%20placement%20already%20looks%20pretty%20similar%20to%20the%20DHL%20setup.%20In%20the%20following%2C%20I%20will%20evaluate%20whether%20a%20more%20sophisticated%20optimization%20approach%20results%20in%20better%20reliability%20and%20cost-efficiency%20compare%20to%20the%20simple%20benchmark.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20Fullscreen%2C%0A%20%20%20%20anzahl_slider%2C%0A%20%20%20%20cm%2C%0A%20%20%20%20folium%2C%0A%20%20%20%20heuristic_APLs%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20packstations%2C%0A%20%20%20%20wuerzburg_gdf%2C%0A)%3A%0A%20%20%20%20%23%20Apply%20heuristic%0A%20%20%20%20anzahl%20%3D%20anzahl_slider.value%20%20%23%20Vom%20Slider%20holen%0A%20%20%20%20gewaehlte_packzellen%20%3D%20heuristic_APLs(wuerzburg_gdf%2C%20anzahl%3Danzahl)%0A%0A%0A%20%20%20%20%23%20Create%20map%0A%20%20%20%20m%20%3D%20folium.Map(location%3D%5B49.7925%2C%209.9380%5D%2C%20zoom_start%3D13%2C%20tiles%3D'cartodbpositron')%0A%20%20%20%20Fullscreen().add_to(m)%0A%0A%0A%20%20%20%20%23%20Population%20layer%20100m%0A%20%20%20%20colormap%20%3D%20cm.linear.YlOrRd_09.scale(0%2C%20200)%0A%20%20%20%20colormap.caption%20%3D%20'Population%20per%20grid-cell'%0A%0A%20%20%20%20layer_100m%20%3D%20folium.FeatureGroup(name%3D'Population%20100m-Grid'%2C%20overlay%3DTrue%2C%20control%3DTrue)%0A%20%20%20%20folium.GeoJson(%0A%20%20%20%20%20%20%20%20'.%2FData%2Fwuerzburg_bevoelkerung_100m.geojson'%2C%0A%20%20%20%20%20%20%20%20name%3D'Population%20100m-grid'%2C%0A%20%20%20%20%20%20%20%20style_function%3Dlambda%20feature%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'fillColor'%3A%20colormap(feature%5B'properties'%5D%5B'Einwohner'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'color'%3A%20'black'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'weight'%3A%200.3%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'fillOpacity'%3A%200.7%2C%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20tooltip%3Dfolium.GeoJsonTooltip(fields%3D%5B'Einwohner'%5D%2C%20aliases%3D%5B'Einwohner%3A'%5D)%2C%0A%20%20%20%20).add_to(layer_100m)%0A%20%20%20%20layer_100m.add_to(m)%0A%0A%0A%20%20%20%20%23%20DHL%20Layer%0A%20%20%20%20dhl_layer%20%3D%20folium.FeatureGroup(name%3D'DHL%20Parcel%20Lockers'%2C%20show%3DFalse)%0A%0A%20%20%20%20for%20i%2C%20ps%20in%20enumerate(packstations)%3A%0A%20%20%20%20%20%20%20%20folium.Marker(%0A%20%20%20%20%20%20%20%20location%3D%5Bps%5B'lat'%5D%2C%20ps%5B'lon'%5D%5D%2C%0A%20%20%20%20%20%20%20%20popup%3Df%22%7Bps%5B'name'%5D%7D%3Cbr%3E%7Bps%5B'address'%5D%7D%22%2C%0A%20%20%20%20%20%20%20%20icon%3Dfolium.Icon(color%3D'blue'%2C%20icon%3D'envelope'%2C%20prefix%3D'glyphicon')%0A%20%20%20%20%20%20%20%20).add_to(dhl_layer)%0A%0A%20%20%20%20dhl_layer.add_to(m)%0A%0A%0A%20%20%20%20%23%20Dynamic%20APL%20Layer%20(heuristisch)%0A%20%20%20%20heuristic_layer%20%3D%20folium.FeatureGroup(name%3D'Heuristic%20APL%20Locations'%2C%20show%3DTrue)%0A%0A%20%20%20%20for%20_%2C%20row%20in%20gewaehlte_packzellen.iterrows()%3A%0A%20%20%20%20%20%20%20%20centroid%20%3D%20row%5B'geometry'%5D.centroid%0A%20%20%20%20%20%20%20%20folium.Marker(%0A%20%20%20%20%20%20%20%20%20%20%20%20location%3D%5Bcentroid.y%2C%20centroid.x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20popup%3Df%22Einwohner%3A%20%7Brow%5B'Einwohner'%5D%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20icon%3Dfolium.Icon(color%3D'green'%2C%20icon%3D'envelope')%0A%20%20%20%20%20%20%20%20).add_to(heuristic_layer)%0A%0A%20%20%20%20heuristic_layer.add_to(m)%0A%0A%20%20%20%20folium.LayerControl(collapsed%3DTrue%2C%20position%3D'topleft').add_to(m)%0A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20anzahl_slider%2C%0A%20%20%20%20%20%20%20%20m%0A%20%20%20%20%5D%2C%20gap%3D2%2C%20align%3D'center')%0A%20%20%20%20return%20colormap%2C%20dhl_layer%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%23System%20Dynamics%20Model%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20In%20the%20next%20step%2C%20I%20adapted%20the%20Stocks%20and%20Flows%20Diagram%20by%20Rabe%20et%20al.%20to%20W%C3%BCrzburg%20to%20simulate%20the%20demand%20for%20APL%20deliveries%20over%20the%20next%2010%20years%20using%20Vensim.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22)%2C%0A%20%20%20%20%20%20%20%20mo.image(src%3D%22.%2FImages%2FAPL-SFD-W%C3%BCrzburg-V3.png%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20width%3D450%2C%20style%3D%7B%22margin-right%22%3A%20%22auto%22%2C%20%22margin-left%22%3A%20%22auto%22%7D)%2C%0A%20%20%20%20%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20mo.vstack(%5B%0A%20%20%20%20%23%20%20%20%20%20mo.md(%22%23%23Simulation%20results%22)%2C%0A%20%20%20%20%23%20%20%20%20%20mo.hstack(%5B%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%23%20market_size_chart%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20apl_users_chart%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20purchases_chart%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20deliveries_chart%2C%0A%20%20%20%20%23%20%20%20%20%20%5D)%2C%0A%20%20%20%20%23%20%20%20%20%20mo.callout(filtered_simulation_results)%2C%0A%20%20%20%20%23%20%5D%2C%20align%3D%22center%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20deliveries_chart%20%3D%20alt.Chart(simulation_results).mark_line().encode(%0A%20%20%20%20%23%20%20%20%20%20x%3Dalt.X(%22time%3AQ%22)%2C%0A%20%20%20%20%23%20%20%20%20%20y%3Dalt.Y(%22Number%20of%20deliveries%3AQ%22)%0A%20%20%20%20%23%20)%0A%0A%20%20%20%20%23%20apl_users_chart%20%3D%20alt.Chart(simulation_results).mark_line().encode(%0A%20%20%20%20%23%20%20%20%20%20x%3Dalt.X(%22time%3AQ%22)%2C%0A%20%20%20%20%23%20%20%20%20%20y%3Dalt.Y(%22APL%20users%22)%0A%20%20%20%20%23%20)%0A%0A%20%20%20%20%23%20purchases_chart%20%3D%20alt.Chart(simulation_results).mark_line().encode(%0A%20%20%20%20%23%20%20%20%20%20x%3Dalt.X(%22time%3AQ%22)%2C%0A%20%20%20%20%23%20%20%20%20%20y%3Dalt.Y(%22Online%20purchases%20per%20year%3AQ%22)%0A%20%20%20%20%23%20)%0A%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23Demand%20Scenarios%0A%0A%20%20%20%20After%20getting%20an%20idea%20of%20the%20demand%20development%20over%20the%20next%2010%20years%2C%20I%20created%2020%20demand%20scenarios%20following%20a%20normal%20distribution%2C%20with%20increasing%20uncertainty%20in%20future%20periods.%20Demand%20refers%20to%20the%20number%20of%20deliveries%20to%20APLs%20per%20year.%20The%20scenarios%20are%20ordered%20from%20pessimistic%20to%20optimistic.%20%0A%20%20%20%20The%20scenario-%20and%20time-dependent%20demand%20is%20modeled%20as%20a%20normally%20distributed%20random%20variable%3A%0A%0A%20%20%20%20%24%24%0A%20%20%20%20D_%7Bts%7D%20%5Csim%20%5Cmathcal%7BN%7D(%5Cmu_%7Bts%7D%2C%20%5Csigma_%7Bts%7D%5E2)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20with%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmu_%7Bts%7D%20%3D%20D_t%20%5Ccdot%20f_s%0A%20%20%20%20%5Cquad%20%5Ctext%7Band%7D%20%5Cquad%0A%20%20%20%20%5Csigma_%7Bts%7D%20%3D%20%5Cdelta%20%5Ccdot%20t%20%5Ccdot%20%5Cmu_%7Bts%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5Cdelta%20%3D%200.01%24%20is%20a%20scaling%20parameter%20for%20the%20uncertainty%2C%20%20%0A%20%20%20%20%24D_t%24%20is%20the%20simulated%20base%20demand%20in%20month%20%24t%24%2C%20and%20%20%0A%20%20%20%20%24f_s%24%20is%20a%20scenario-dependent%20factor%20linearly%20spaced%20between%200.9%20and%201.1.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(interactive_chart%2C%20mo%2C%20scenario_selection)%3A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20interactive_chart%2C%0A%20%20%20%20%20%20%20%20scenario_selection%0A%20%20%20%20%5D%2C%20gap%3D2%2C%20align%3D%22center%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20mo%2C%20scenario_df)%3A%0A%20%20%20%20%23%20Scenario-selection%20ui-element%0A%0A%20%20%20%20color_scale%20%3D%20alt.Scale(scheme%3D%22redyellowgreen%22)%0A%20%20%20%20scenario_options%20%3D%20scenario_df%5B%22Scenario%22%5D.unique()%0A%20%20%20%20default_scenarios%20%3D%20%5B%22Scenario1%22%2C%20%22Scenario10%22%2C%20%22Scenario20%22%5D%0A%0A%20%20%20%20scenario_selection%20%3D%20mo.ui.multiselect(%0A%20%20%20%20%20%20%20%20scenario_options%2C%20label%3D%22Select%20the%20scenarios%20you%20want%20to%20display%22%2C%20value%3Ddefault_scenarios%0A%20%20%20%20)%0A%20%20%20%20return%20color_scale%2C%20scenario_selection%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20color_scale%2C%20scenario_df%2C%20scenario_selection)%3A%0A%20%20%20%20%23%20Demand-scenario%20chart%0A%0A%20%20%20%20filtered_df%20%3D%20scenario_df%5Bscenario_df%5B%22Scenario%22%5D.isin(scenario_selection.value)%5D%0A%0A%20%20%20%20interactive_chart%20%3D%20alt.Chart(filtered_df).mark_line().encode(%0A%20%20%20%20%20%20%20%20x%3Dalt.X(%22Year%3AQ%22%2C%20title%3D%22Year%22)%2C%0A%20%20%20%20%20%20%20%20y%3Dalt.Y(%22Demand%3AQ%22%2C%20title%3D%22Demand%22)%2C%0A%20%20%20%20%20%20%20%20color%3Dalt.Color(%22Scenario_Number%3AN%22%2C%20scale%3Dcolor_scale%2C%20legend%3Dalt.Legend(title%3D%22Scenario%22))%2C%0A%20%20%20%20%20%20%20%20tooltip%3D%5B'Scenario'%2C%20'Year'%2C%20'Demand'%5D%20%0A%20%20%20%20).properties(%0A%20%20%20%20%20%20%20%20width%3D700%2C%0A%20%20%20%20%20%20%20%20height%3D400%2C%0A%20%20%20%20%20%20%20%20title%3D%22Generated%20demand%20scenarios%22%0A%20%20%20%20)%0A%20%20%20%20return%20(interactive_chart%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20summary_df)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20f%22%22%22%0A%20%20%20%20%23%20Optimization%0A%0A%20%20%20%20In%20the%20next%20step%2C%20I%20modeled%20the%20problem%20as%20a%20Capacitated%20**Facility%20Location%20Problem%20(CFLP)**.%20The%20initial%20dataset%20consists%20of%20100-meter%20grid%20cells%20across%20the%20city%20of%20W%C3%BCrzburg%2C%20each%20representing%20a%20potential%20facility%20site%20or%20demand%20point.%20However%2C%20including%20all%20grid%20cells%20as%20possible%20facility%20locations%20would%20result%20in%20an%20intractably%20large%20number%20of%20decision%20variables.%20%20%0A%20%20%20%20To%20address%20this%20issue%2C%20I%20used%20clustering%20techniques%20to%20reduce%20the%20candidate%20locations%20to%20**60%20population-based%20clusters**%2C%20which%20serve%20as%20aggregated%20potential%20APL%20sites.%20For%20the%20demand%20sites%2C%20I%20started%20of%20with%20a%20**300-meter%20grid**.%20The%20resulting%20optimization%20model%20is%20implemented%20in%20Pyomo%20and%20solved%20using%20the%20CPLEX%20solver.%20%20%0A%20%20%20%20I%20solve%20the%20problem%20over%20a%20ten-year%20time%20horizon.%0A%20%20%20%20In%20total%2C%20**%7Bsummary_df%5B'Total_APLs_Opened'%5D.sum()%7D%20APLs**%20are%20deployed%20for%20a%20defined%20base%20case.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20Fullscreen%2C%0A%20%20%20%20colormap%2C%0A%20%20%20%20dhl_layer%2C%0A%20%20%20%20folium%2C%0A%20%20%20%20potential_locations_gdf%2C%0A%20%20%20%20results_df%2C%0A%20%20%20%20summary_df%2C%0A)%3A%0A%20%20%20%20%23%20Create%20second%20map%0A%0A%20%20%20%20m1%20%3D%20folium.Map(location%3D%5B49.7925%2C%209.9380%5D%2C%20zoom_start%3D13%2C%20tiles%3D'cartodbpositron')%0A%20%20%20%20Fullscreen().add_to(m1)%0A%20%20%20%20dhl_layer.add_to(m1)%0A%0A%20%20%20%20%23%20Population%20layer%20300m%0A%20%20%20%20layer_300m%20%3D%20folium.FeatureGroup(name%3D'Population%20300m-Grid'%2C%20overlay%3DTrue%2C%20control%3DTrue%2C%20show%3DTrue)%0A%20%20%20%20folium.GeoJson(%0A%20%20%20%20%20%20%20%20'.%2FData%2Fwuerzburg_bevoelkerung_300m.geojson'%2C%0A%20%20%20%20%20%20%20%20name%3D'Population%20300m-Grid'%2C%0A%20%20%20%20%20%20%20%20style_function%3Dlambda%20feature%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'fillColor'%3A%20colormap(feature%5B'properties'%5D%5B'Einwohner'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'color'%3A%20'black'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'weight'%3A%200.3%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'fillOpacity'%3A%200.7%2C%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20tooltip%3Dfolium.GeoJsonTooltip(fields%3D%5B'Einwohner'%5D%2C%20aliases%3D%5B'Einwohner%3A'%5D)%2C%0A%20%20%20%20).add_to(layer_300m)%0A%0A%20%20%20%20layer_300m.add_to(m1)%0A%0A%20%20%20%20%23%20Potential%20Locations%20Layer%0A%20%20%20%20cluster_layer%20%3D%20folium.FeatureGroup(name%3D'Potential%20APL%20Locations%20(Population%20Clusters)'%2C%20show%3DTrue)%0A%20%20%20%20apl_centroids%20%3D%20potential_locations_gdf.copy()%0A%20%20%20%20apl_centroids%5B%22geometry%22%5D%20%3D%20apl_centroids%5B%22geometry%22%5D.centroid%0A%0A%20%20%20%20for%20idx%2C%20pt%20in%20apl_centroids.iterrows()%3A%0A%20%20%20%20%20%20%20%20lat1%2C%20lon1%20%3D%20pt%5B'geometry'%5D.y%2C%20pt%5B'geometry'%5D.x%0A%20%20%20%20%20%20%20%20folium.CircleMarker(%0A%20%20%20%20%20%20%20%20%20%20%20%20location%3D(lat1%2C%20lon1)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20popup%3Df%22APL-ID%3A%7Bpt%5B'Gitter_ID_100m'%5D%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20radius%3D4%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22blue%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20fill%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20fill_opacity%3D0.8%0A%20%20%20%20%20%20%20%20).add_to(cluster_layer)%0A%0A%20%20%20%20cluster_layer.add_to(m1)%0A%0A%20%20%20%20%23%20Deployed%20APLs%20Layer%0A%20%20%20%20selected_apls%20%3D%20summary_df%5B%22APL_ID%22%5D.tolist()%0A%20%20%20%20deployed_apls%20%3D%20apl_centroids%5Bapl_centroids%5B%22Gitter_ID_100m%22%5D.isin(selected_apls)%5D%0A%0A%20%20%20%20selected_layer%20%3D%20folium.FeatureGroup(name%3D%22Deployed%20APLs%22%2C%20show%3DFalse)%0A%0A%20%20%20%20for%20_%2C%20apl%20in%20deployed_apls.iterrows()%3A%0A%20%20%20%20%20%20%20%20popup_text%20%3D%20f%22APL%20%7Bapl%7D%22%0A%20%20%20%20%20%20%20%20folium.CircleMarker(%0A%20%20%20%20%20%20%20%20%20%20%20%20location%3D%5Bapl%5B'geometry'%5D.y%2C%20apl%5B'geometry'%5D.x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20radius%3D4%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22%237a92f2%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20fill%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20popup%3Dpopup_text%0A%20%20%20%20%20%20%20%20).add_to(selected_layer)%0A%0A%20%20%20%20selected_layer.add_to(m1)%0A%0A%20%20%20%20%23%20Underperformer%0A%20%20%20%20underutilized_apls%20%3D%20summary_df%5Bsummary_df%5B%22Underutilized_Most_Periods%22%5D%20%3D%3D%20True%5D%5B%22APL_ID%22%5D.tolist()%0A%20%20%20%20highlighted_apls%20%3D%20apl_centroids%5Bapl_centroids%5B%22Gitter_ID_100m%22%5D.isin(underutilized_apls)%5D%0A%0A%20%20%20%20low_utilization_layer%20%3D%20folium.FeatureGroup(name%3D%22Low%20capacity%20utilization%20APLs%22%2C%20show%3DFalse)%0A%0A%20%20%20%20for%20_%2C%20apl%20in%20highlighted_apls.iterrows()%3A%0A%20%20%20%20%20%20%20%20folium.Marker(%0A%20%20%20%20%20%20%20%20%20%20%20%20location%3D%5Bapl%5B'geometry'%5D.y%2C%20apl%5B'geometry'%5D.x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20popup%3D%22Underutilized%20in%20%3E50%25%20of%20periods%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20icon%3Dfolium.Icon(color%3D'red'%2C%20icon%3D'info-sign')%0A%20%20%20%20%20%20%20%20).add_to(low_utilization_layer)%0A%0A%20%20%20%20low_utilization_layer.add_to(m1)%0A%0A%20%20%20%20%23%20APL-Customer%20connections%0A%20%20%20%20for%20t%20in%20sorted(results_df%5B'Period'%5D.unique())%3A%0A%20%20%20%20%20%20%20%20group%20%3D%20folium.FeatureGroup(name%3Df%22Period%20%7Bt%7D%22%2C%20show%3DFalse)%0A%0A%20%20%20%20%20%20%20%20df_t%20%3D%20results_df%5Bresults_df%5B'Period'%5D%20%3D%3D%20t%5D%0A%0A%20%20%20%20%20%20%20%20for%20apl_id%2C%20sub_df%20in%20df_t.groupby(%22APL_ID%22)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20apl_point%20%3D%20sub_df%5B'APL_geometry'%5D.iloc%5B0%5D.centroid%0A%20%20%20%20%20%20%20%20%20%20%20%20popup_text%20%3D%20f%22APL%20%7Bapl_id%7D%3Cbr%3EKunden%3A%20%7Bsub_df%5B'Customer_ID'%5D.nunique()%7D%22%0A%20%20%20%20%20%20%20%20%20%20%20%20folium.CircleMarker(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20location%3D%5Bapl_point.y%2C%20apl_point.x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20radius%3D4%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22%237a92f2%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill_opacity%3D0.8%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20popup%3Dpopup_text%0A%20%20%20%20%20%20%20%20%20%20%20%20).add_to(group)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Verbindungen%20zu%20Kunden%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_%2C%20row_%20in%20sub_df.iterrows()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20apl_centroid%20%3D%20row_%5B'APL_geometry'%5D.centroid%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cust_centroid%20%3D%20row_%5B'Customer_geometry'%5D.centroid%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20folium.PolyLine(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20locations%3D%5B%5Bapl_centroid.y%2C%20apl_centroid.x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bcust_centroid.y%2C%20cust_centroid.x%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22%237a92f2%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20weight%3D1%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20).add_to(group)%0A%0A%20%20%20%20%20%20%20%20group.add_to(m1)%0A%0A%20%20%20%20folium.LayerControl(collapsed%3DTrue%2C%20position%3D%22bottomleft%22).add_to(m1)%0A%0A%20%20%20%20m1%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20pd)%3A%0A%20%20%20%20evaluation_df%20%3D%20pd.read_csv(%22.%2FData%2Frobustness-analysis.csv%22%2C%20sep%3D%22%3B%22)%0A%20%20%20%20relevant_columns%20%3D%20%5B'Test%20Case'%2C%20'Parameter'%2C%20'Number%20of%20opened%20APLs'%2C%20'Combined%20Reliability'%2C%20'Combined%20costs'%2C%20'Remark'%5D%0A%20%20%20%20evaluation_df%20%3D%20evaluation_df%5Brelevant_columns%5D.copy()%0A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Results%0A%20%20%20%20%20%20%20%20To%20evaluate%20different%20APL%20placement%20strategies%2C%20I%20conducted%20a%20comprehensive%20reliability%20and%20cost%20analysis%20across%20a%20variety%20of%20parameter%20settings%20and%20demand%20scenarios.%20I%20defined%20a%20base%20case%20and%20then%20systematically%20altered%20one%20parameter%20at%20a%20time%20in%20the%20subsequent%20test%20cases.%0A%0A%20%20%20%20%20%20%20%20For%20reliability%20evaluation%20I%20conducted%20a%20**Monte%20Carlo%20Simulation**%3A%0A%20%20%20%20%20%20%20%20*%20For%20each%20of%20the%20100%20simulation%20runs%2C%20I%20generated%20random%20demand%20values%20for%20each%20grid%20cell%20and%20time%20period.%20%0A%20%20%20%20%20%20%20%20*%20These%20values%20were%20drawn%20from%20a%20normal%20distribution%2C%20using%20the%20SD%20model%20output%20as%20the%20expected%20value%20and%20a%20standard%20deviation%20of%2020%25%2C%20and%20distributed%20proportionally%20to%20the%20population%20density%20of%20each%20customer%20cell.%0A%20%20%20%20%20%20%20%20If%20an%20APL%E2%80%99s%20capacity%20was%20exceeded%2C%20I%20recorded%20both%20the%20frequency%20of%20overloads%20and%20the%20amount%20of%20unsatisfied%20demand.%20From%20this%2C%20I%20derived%20a%20**Combined%20Reliability**%20score%0A%0A%20%20%20%20%20%20%20%20The%20**Combined%20Costs**%20consist%20of%20the%20setup%20costs%2C%20derived%20in%20the%20CFLP%20and%20the%20variable%20delivery%20costs.%20I%20calculated%20the%20delivery%20costs%20using%20real-life%20routes%2C%20derived%20from%20the%20Open%20Source%20Routing%20Machine%20(OSRM)%20API%20and%20a%20**Capacitated%20Vehicle%20Routing%20Problem%20(CVRP)**.%0A%0A%20%20%20%20%20%20%20%20%22%22%22)%0A%0A%20%20%20%20return%20(evaluation_df%2C)%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20evaluation_df%2C%20mo)%3A%0A%20%20%20%20%23%20Farbskala%20definieren%0A%20%20%20%20color_scale_dots%20%3D%20alt.Scale(%0A%20%20%20%20%20%20%20%20domain%3D%5B1%2C%202%2C%203%2C%204%2C%205%2C%206%2C%207%2C%208%2C%209%2C%2010%2C%2011%2C%2012%5D%2C%0A%20%20%20%20%20%20%20%20range%3D%5B'red'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C%20'orange'%2C'red'%5D%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Selection%20for%20interactivity%0A%20%20%20%20selection%20%3D%20alt.selection_point(name%3D%22selected%22%2C%20fields%3D%5B%22Test%20Case%22%5D)%0A%0A%20%20%20%20%23%20Base%20chart%20for%20the%20circles%0A%20%20%20%20base%20%3D%20alt.Chart(evaluation_df).mark_circle(size%3D100).encode(%0A%20%20%20%20%20%20%20%20x%3Dalt.X(%22Combined%20costs%3AQ%22%2C%20title%3D%22Combined%20Costs%22)%2C%0A%20%20%20%20%20%20%20%20y%3Dalt.Y(%22Combined%20Reliability%3AQ%22%2C%20title%3D%22Combined%20Reliability%22)%2C%0A%20%20%20%20%20%20%20%20color%3Dalt.condition(selection%2C%20%22Test%20Case%3AN%22%2C%20alt.value(%22lightgray%22)%2C%20scale%3Dcolor_scale_dots)%2C%0A%20%20%20%20%20%20%20%20tooltip%3D%5B%22Test%20Case%3AN%22%2C%20%22Combined%20costs%3AQ%22%2C%20%22Combined%20Reliability%3AQ%22%5D%0A%20%20%20%20).add_params(selection)%0A%0A%20%20%20%20%23%20Text%20labels%0A%20%20%20%20text%20%3D%20alt.Chart(evaluation_df).mark_text(%0A%20%20%20%20%20%20%20%20align%3D'center'%2C%0A%20%20%20%20%20%20%20%20baseline%3D'middle'%2C%0A%20%20%20%20%20%20%20%20fontSize%3D11%2C%0A%20%20%20%20%20%20%20%20dx%3D-9%2C%20%20%23%20Nudge%20the%20text%20to%20the%20right%0A%20%20%20%20%20%20%20%20dy%3D0%20%20%20%23%20Nudge%20the%20text%20up%0A%20%20%20%20).encode(%0A%20%20%20%20%20%20%20%20x%3Dalt.X(%22Combined%20costs%3AQ%22)%2C%0A%20%20%20%20%20%20%20%20y%3Dalt.Y(%22Combined%20Reliability%3AQ%22)%2C%0A%20%20%20%20%20%20%20%20text%3D%22Test%20Case%3AN%22%2C%0A%20%20%20%20%20%20%20%20color%3Dalt.condition(selection%2C%20alt.value(%22black%22)%2C%20alt.value(%22black%22))%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Combine%20the%20layers%0A%20%20%20%20chart%20%3D%20(base%20%2B%20text).properties(%0A%20%20%20%20%20%20%20%20width%3D600%2C%20height%3D400%2C%20title%3D%22Reliability%20vs%20Total%20Costs%22%0A%20%20%20%20)%0A%0A%20%20%20%20chart%20%3D%20mo.ui.altair_chart(chart)%0A%0A%20%20%20%20return%20(chart%2C)%0A%0A%0A%40app.cell%0Adef%20_(chart)%3A%0A%20%20%20%20selected%20%3D%20chart.selections%0A%20%20%20%20return%20(selected%2C)%0A%0A%0A%40app.cell%0Adef%20_(evaluation_df%2C%20selected)%3A%0A%20%20%20%20selected_cases%20%3D%20selected.get(%22selected%22%2C%20%7B%7D).get(%22Test%20Case%22%2C%20%5B%5D)%0A%20%20%20%20print(selected_cases)%0A%20%20%20%20filtered_evaluation_df%20%3D%20evaluation_df%5Bevaluation_df%5B%22Test%20Case%22%5D.isin(selected_cases)%5D%0A%20%20%20%20return%20(filtered_evaluation_df%2C)%0A%0A%0A%40app.cell%0Adef%20_(chart%2C%20filtered_evaluation_df%2C%20mo)%3A%0A%20%20%20%20mo.callout(%0A%20%20%20%20%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Click%20on%20data%20points%20in%20the%20chart%20for%20more%20information.%20Hold%20%3Ckbd%3EShift%3C%2Fkbd%3E%20and%20%3Ckbd%3ELeft%20Click%3C%2Fkbd%3E%20to%20select%20multiple%20points.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20filtered_evaluation_df%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20chart%0A%20%20%20%20%20%20%20%20%5D)%0A%20%20%20%20)%0A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
